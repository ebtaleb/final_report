\chapter{Conclusion\label{cha:chapter5}}

\section{Summary\label{sec:summary}}

\noindent The work done during the last 6 months can be summarized into the following work steps:

\begin{itemize}
		\item Propagation of debugging events through the backend
		\vspace{-0.11in}
		\item Integration of the DWARF emitter and fixes
		\vspace{-0.11in}
		\item Implementation of the DWARF reading library
		\vspace{-0.11in}
		\item Implementation and integration of a OCaml language plugin for LLDB
		\vspace{-0.11in}
		\item Additions to the native debugger ocp-lldb
\end{itemize}

\section{State of related works\label{sec:outlook}}

Those additions were done and tested on a x86 64-bit system using Linux, on a
closed project fork of the OCaml compiler version 4.02.1, including memory
profiling facilities, debugging events propagation specific to the clambda
middle end and type information inclusion into binaries.
It should be released in the near future.

\begin{itemize}

\item
The OCaml language plugin reached the LLDB
codebase\footnote{\url{http://reviews.llvm.org/D22132}}, and will arrive on LLDB
4.0.

\item Other remaining patches such as the name demangling features
still have to be integrated into LLDB, although it
may depend on the final form of the debugging features.

\item The work done on ocp-lldb and ocplib-dwarf has been submitted and is now
awaiting integration.
Pull requests can be seen
there\footnote{\url{http://github.com/OCamlPro/typerex-lldb/pull/4}}
\footnote{\url{http://github.com/OCamlPro/typerex-binutils/pull/1}}.
\end{itemize}

\subsection{Areas of improvement and remaining work}

\begin{itemize}
    \item Increase number of debugging events and their accuracy as to increase the number of possible breakpoints.
    \item Improve the data-flow analysis.
    \item Integrate remaining compiler patches to the official OCaml codebase.
    \item Integrate remaining LLDB patches.
\end{itemize}

\subsection{Extensions}

\begin{itemize}
    \item Make it possible to coerce the type of identifiers inserted at the
lambda pass and that the typed AST, nor the symbol table it is based on are not
aware of.
\end{itemize}

\subsection{Related works}

\begin{itemize}
    \item This work\footnote{\url{http://github.com/ocaml/ocaml/pull/247}} makes backtraces aware
        of inline function calls (by creating fake stack frames?)
        It could be possible to express the inlined function attribute in DWARF data for
        inlined functions to aid the debugger.
    \item The debugging facilities used in the present work \footnote{\url{http://github.com/ocaml/ocaml/pull/574}}
        may be available for OCaml 4.05, although they are still in an
        experimental state.
        Improvements brought by the original developer concerns mostly a
        new, middle-end, inlining compiler pass called flambda.
        Notable additions includes submodule name presence in module paths and
        the addition of `phantom lets` for access to constant values affected by
        consant folding and not present in the machine code.
    \item libmonda\footnote{\url{http://github.com/mshinwell/libmonda}} aims to be a
        debugger-independent, OCaml debugging layer library for helping with
        interpretation of values at runtime.
\end{itemize}

\section{Dissemination\label{sec:dissemination}}

The work presented here will certainly be of interest to OCaml users and system
programmers, developers without knowledge of assembly yet interested in native
code debugging.

%\section{Problems Encountered\label{sec:problems}}

%Summarize the main problems. How did you solve them? Why didn't you solve them?

%value inconsistencies
%addition of .loc directives due to debugging events propagation the compiler is not aware of
%the address ranges variables are available at

%the available\_ranges pass is not exempt of bugs either, still experimental

% chronophage car precision de methode naive + temps de compilation de la compiler suite
% comment faire composer les differents constructs ensemble

%User experience/interface minor:
%- no function name symbol displayed in the backtrace
%- global variables becomes available/displayed only after second call to `frame variable`

%- value identifiers inserted at the lambda pass (bound, clos, index for loop,
%match), not present in cmt/typedtree

%infinity of programs with combination of constructs to test whether they play
%out nicely together

%case of if\_const\_int.ml: goes back in the source to perform assignment to the
%b variable somewhat makes sense, although counter intuitive

%global values bindings/vars are unmangled and see below

\section{Lessons drawn from the internship}

I benefited in many ways from that internship.\\
\begin{itemize}
    \item I learned about the inner workings of the OCaml toolchain,
    \item I acquainted myself with multiple projects (OCaml, lldb) and contributed to their codebases,
    \item I learned how debugging information is collected, synthetized and used
        in a debugger.
    \item I learned how to perform a weekly reporting of progress,
    \item I learned how to manage my time between multiple related projects in
        parallel.
\end{itemize}
